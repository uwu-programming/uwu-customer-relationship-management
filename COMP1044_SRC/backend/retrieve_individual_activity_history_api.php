<?php

// continue the session
session_start();

// specify return type
header("Content-Type: application/json");

// connect to database
require "database_connection.php";

switch($_SERVER["REQUEST_METHOD"]){
    case "POST":
        retrieve_individual_option($conn);
        break;
    
    default:
        retrieve_individual_option($conn);
        break;
}

function retrieve_individual_option($conn){
    try {
        $current_user_id = $_SESSION['user_id'];
        $current_user_role = $_SESSION['user_role'];

        // get the JSON post by the client
        $post_data = json_decode(file_get_contents("php://input"));

        // the SQL query to get all contact
        $sql_query = "SELECT * FROM activity JOIN individual_activity_history ON activity.activity_id = individual_activity_history.activity_id JOIN crm_user ON crm_user.user_id = activity.created_by WHERE individual_id = $post_data->individual_id ORDER BY end_time DESC";

        $statement = $conn->prepare($sql_query);
        $statement->execute();
    } catch (PDOException $error){

    }

    $result = array();
    while ($row = $statement->fetch(PDO::FETCH_ASSOC)){
        array_push($result, $row);
    }

    echo json_encode($result);
}

?>